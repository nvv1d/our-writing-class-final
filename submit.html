<!DOCTYPE html>
<html style="font-size: 16px;" lang="en">
<head>
      <!-- Google Fonts -->
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,500,500i,600,600i,700,700i,800,800i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i|Arimo:400,400i,500,500i,600,600i,700,700i">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <title>Submit Your Assignment</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css">
    <!-- Add React, ReactDOM, and Babel -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <!-- Add Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
  <style>
body {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  background-color: rgba(247, 247, 247, 0.8);
}

img {
  pointer-events: none;
  -webkit-user-drag: none;
  user-drag: none;
}

p, h1, h2, h3, h4, h5, h6 {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
  background-color: #ffffff;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  position: relative;
}

.home-button {
  position: absolute;
  top: 1rem;
  left: 2rem;
  background-color: #e3b377;
  color: white;
  padding: 8px 16px;
  border-radius: 5px;
  text-decoration: none;
  transition: background-color 0.3s ease;
  display: flex;
  align-items: center;
  gap: 4px;
}

.home-button:hover {
  background-color: #d6a462;
}

.title {
  font-size: 2rem;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 1.5rem;
  padding-top: 2rem;
}

.description {
  text-align: justify;
  line-height: 1.6;
  margin-bottom: 2rem;
  color: #333;
  letter-spacing: 0.2px;
}

.topic {
  background-color: rgba(227, 179, 119, 0.2);
  border-radius: 0.5rem;
  padding: 1rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), /* Standard soft shadow */
              0 0 20px rgba(255, 223, 84, 0.4); /* Yellowish glow effect */
}


.topic-title {
  font-size: 1.25rem;
  font-weight: 500;
  color: #e3b377;
  margin-bottom: 0.5rem;
}

.text-area {
  width: 100%;
  height: 400px;
  padding: 1rem;
  border: 1px solid #ccc;
  border-radius: 0.5rem;
  font-size: 1rem;
  font-family: inherit;
  resize: none;
  outline: none;
  transition: border-color 0.3s ease;
  background-color: rgba(255, 255, 255, 0.8);
}

.text-area::placeholder {
  color: #ccc;
  font-style: italic;
}

.text-area:focus {
  border-color: #e3b377;
}

.submit-button {
  background-color: #e3b377;
  color: white;
  padding: 12px 24px;
  border-radius: 5px;
  text-decoration: none;
  transition: background-color 0.3s ease;
  display: inline-block;
  margin-top: 1.5rem;
  border: none;
  cursor: pointer;
}

.submit-button:hover {
  background-color: #d6a462;
}

.submit-message {
  font-size: 1.25rem;
  font-weight: 500;
  color: #2c3e50;
  display: inline-block;
  margin-left: 1rem;
}

.dropdown {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ccc;
  border-radius: 0.5rem;
  font-size: 1rem;
  font-family: inherit;
  background-color: rgba(255, 255, 255, 0.8);
  margin-bottom: 1rem;
  transition: border-color 0.3s ease;
  color: #2c3e50;
}

.dropdown:focus {
  border-color: #e3b377;
  outline: none;
}

.dropdown-label {
  font-weight: 500;
  color: #2c3e50;
  margin-bottom: 0.25rem;
  display: block;
}

@media (max-width: 768px) {
  .container {
    @apply px-6 py-6; /* Reduce padding for mobile */
  }

  .title {
    @apply text-xl pt-6 ml-12; /* Reduce font size, padding, and add left margin on small screens */
  }

  .description {
    @apply text-base leading-8; /* Reduce font size and increase line height for better readability */
  }

  .dropdown,
  .text-area,
  .submit-button {
    @apply text-base; /* Ensure font size is readable */
  }

  .submit-button {
    @apply px-5 py-2.5; /* Adjust button padding */
  }

  .home-button {
    @apply top-2 left-4; /* Reduce top and left position on small screens */
  }
}
  </style>
  <script>
// Disable right-click context menu
document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
}, false);

// Disable Ctrl+U to prevent "view page source"
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key === 'u') {
    e.preventDefault();
  }
});

// Disable Ctrl+Shift+I, F12 to prevent "inspect element"
document.addEventListener('keydown', function(e) {
  if ((e.ctrlKey && e.shiftKey && e.key === 'I') || e.key === 'F12') {
    e.preventDefault();
  }
});
</script>
	    <script>
    // Disable right-click context menu
    document.addEventListener('contextmenu', function(event) {
      event.preventDefault();
    });

    // Disable keyboard shortcuts for copying, printing, and other actions
    document.addEventListener('keydown', function(event) {
      // Block common copy shortcuts: Ctrl+C, Ctrl+X, Ctrl+S, Ctrl+P
      if ((event.ctrlKey || event.metaKey) && (event.key === 'c' || event.key === 'x' || event.key === 's' || event.key === 'p')) {
        event.preventDefault();
      }
    });
  </script>
</head>
<body>
  <div class="container">
    <a href="https://our-writing-class.vercel.app/" class="home-button">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      Home
    </a>
<h1 class="title" style="display: inline-flex; align-items: center; justify-content: center; text-align: center; flex-wrap: wrap; max-width: 100%;">
  <span style="white-space: normal; text-align: center;">Submit Your Assignment</span>
  <img src="https://em-content.zobj.net/source/microsoft-teams/363/writing-hand_light-skin-tone_270d-1f3fb_1f3fb.png" 
       alt="Writing Hand" 
       style="width: 30px; height: 30px; margin-left: 8px; flex-shrink: 0;">
</h1>
	  
    <p class="description">
      Howdy, writer! Welcome to the assignment submission page. This is your chance to shine and share your descriptive writing with the class. Below you'll find a model text describing a place, followed by the structure you should follow. Study the example carefully, then create your own descriptive paragraph following the same pattern. I'm so excited to read your work and provide feedback. Just pour your heart into the text area below, and hit that submit button when you're ready. Let's do this!
    </p>
    <!-- Class and Name dropdowns -->
    <label class="dropdown-label" for="class-dropdown">Class:</label>
    <select id="class-dropdown" class="dropdown">
      <option value="TEFL 402">TEFL 402</option>
    </select>

    <label class="dropdown-label" for="name-dropdown">Name:</label>
    <select id="name-dropdown" class="dropdown">
      <option value="" disabled selected>Select your name</option>
      <option>Dr. Behzadpoor</option>
      <option>Ali Tahavvory</option>
      <option>AmirAli Hashemi</option>
      <option>Asra Bakhtar</option>
      <option>Ata Aghamali</option>
      <option>Farzane Hamdi</option>
      <option>Leyla Ne'mati</option>
      <option>Maryam Germchi</option>
      <option>Nahid Mohammadi</option>
      <option>Sahar Seraj</option>
      <option>Tohid Sabbagh</option>
      <option>Zahra Sa'adatKhah</option>
    </select>

<div class="topic">
  <h2 class="topic-title">Topic: Describe a Place That Means Something to You</h2>
	  <br>

  <p><strong>Model Paragraph:</strong></p>
  <p>The beach is my favorite place. The sand is golden and soft beneath my feet. The sound of waves is calming, and the smell of salty air refreshes me. I love to watch the sunset paint the sky in vibrant colors. The beach always makes me feel peaceful.</p>
  <br>
  <p><strong>Structure:</strong></p>
  <ul>
        <li>Firstly, introduce the place you're describing</li>
        <li>Next, share vivid sensory details (sight, hearing, taste, touch, smell) about the location</li>
        <li>Then, explain why this place is special to you</li>
        <li>Use descriptive language to bring the place to life</li>
    </ul>
</div>
<textarea class="text-area" placeholder="Begin by naming the place that holds significance for you...
	
Describe what you see, hear, smell, and feel in this location...
	
Explain the emotional connection or meaning this place has for you...
	
Use rich, descriptive language to help readers experience the place through your words."></textarea>

    <!-- React root div -->
    <div id="submit-button-root"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>

<!-- React component with fixed validation -->
<script type="text/babel">
  const TelegramIntegration = () => {
    const [submittedText, setSubmittedText] = React.useState('');
    const [isSubmitting, setIsSubmitting] = React.useState(false);
    const [submissionStatus, setSubmissionStatus] = React.useState(null);

    const handleSubmit = async () => {
      const textareaValue = document.querySelector('.text-area').value.trim();
      const nameDropdown = document.getElementById('name-dropdown').value;
      const classDropdown = document.getElementById('class-dropdown').value;

      // Clear previous status before new submission attempt
      setSubmissionStatus(null);

      // Validation checks
      if (!textareaValue) {
        setSubmissionStatus("empty");
        return;
      }
      if (!nameDropdown) {
        setSubmissionStatus("nameEmpty");
        return;
      }

      setIsSubmitting(true);

      try {
        const response = await axios.post('/api/submitAssignment', {
          message: `Class: ${classDropdown}\nName: ${nameDropdown}\n\n${textareaValue}`,
        });

        if (response.data.success) {
          setSubmittedText(textareaValue);
          setSubmissionStatus("success");

          // Trigger confetti effect
          const confettiSettings = { target: 'confetti-canvas' };
          const confetti = new ConfettiGenerator(confettiSettings);
          confetti.render();
          setTimeout(() => confetti.clear(), 3000);
        } else {
          setSubmissionStatus("error");
        }
      } catch (error) {
        console.error('Error:', error);
        setSubmissionStatus("error");
      } finally {
        setIsSubmitting(false);
      }
    };

    return (
      <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
        <button
          className="submit-button"
          onClick={handleSubmit}
          disabled={isSubmitting}
          style={{ opacity: isSubmitting ? 0.7 : 1 }}
        >
          {isSubmitting ? 'Submitting...' : 'Submit Assignment'}
        </button>
        {submissionStatus && (
          <span style={{
            color: submissionStatus === "success" ? "#4CAF50" : "#f44336",
            fontWeight: '600',
            fontSize: '16px'
          }}>
            {submissionStatus === "success" ? "Submitted Successfully!" :
             submissionStatus === "nameEmpty" ? "Please select your name!" :
             submissionStatus === "empty" ? "Please write something before submitting!" :
             "An error occurred while submitting."}
          </span>
        )}
      </div>
    );
  };

  // Render the React component
  ReactDOM.render(
    <TelegramIntegration />,
    document.getElementById('submit-button-root')
  );
      // Function to smoothly scroll dropdown into view on mobile
function smoothScrollToCenter(element) {
  const rect = element.getBoundingClientRect();
  const isMobile = window.innerWidth <= 768;

  if (isMobile) {
    window.scrollTo({
      top: rect.top + window.scrollY - (window.innerHeight / 2) + (rect.height / 2),
      behavior: "smooth",
    });
  }
}

// Attach event listeners to dropdowns
document.getElementById('class-dropdown').addEventListener('focus', function () {
  smoothScrollToCenter(this);
});
document.getElementById('name-dropdown').addEventListener('focus', function () {
  smoothScrollToCenter(this);
});

</script>
<canvas id="confetti-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></canvas>
	
    <!-- Add a container for the React chat component -->
    <div id="chat-container"></div>

    <!-- React Component -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Send, MessageCircle, X } = lucide;

        const ChatPlugin = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([]);
            const [inputMessage, setInputMessage] = useState('');
            const [username, setUsername] = useState('');
            const [isUsernameSet, setIsUsernameSet] = useState(false);
            const messagesEndRef = useRef(null);
            const websocketRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            useEffect(() => {
                // Replace with your WebSocket server URL
                websocketRef.current = new WebSocket('wss://your-websocket-server.com/chat');

                websocketRef.current.onopen = () => {
                    console.log('WebSocket Connected');
                };

                websocketRef.current.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    setMessages(prevMessages => [...prevMessages, message]);
                };

                websocketRef.current.onclose = () => {
                    console.log('WebSocket Disconnected');
                };

                return () => {
                    websocketRef.current.close();
                };
            }, []);

            const sendMessage = () => {
                if (inputMessage.trim() && websocketRef.current) {
                    const messageObject = {
                        username,
                        text: inputMessage,
                        timestamp: new Date().toISOString()
                    };

                    websocketRef.current.send(JSON.stringify(messageObject));
                    setInputMessage('');
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            };

            const setUsernameFn = () => {
                if (username.trim()) {
                    setIsUsernameSet(true);
                }
            };

            return (
                <div className="fixed bottom-4 right-4 z-50">
                    {!isOpen ? (
                        <button 
                            onClick={() => setIsOpen(true)}
                            className="bg-blue-500 text-white p-3 rounded-full shadow-lg hover:bg-blue-600 transition-colors"
                        >
                            <MessageCircle size={24} />
                        </button>
                    ) : (
                        <div className="w-80 h-[500px] bg-white rounded-lg shadow-xl border flex flex-col">
                            <div className="bg-blue-500 text-white p-4 flex justify-between items-center rounded-t-lg">
                                <h2 className="text-lg font-semibold">Community Chat</h2>
                                <button 
                                    onClick={() => setIsOpen(false)}
                                    className="hover:bg-blue-600 p-1 rounded"
                                >
                                    <X size={20} />
                                </button>
                            </div>

                            {!isUsernameSet ? (
                                <div className="p-4 flex flex-col space-y-2">
                                    <input 
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        placeholder="Enter your name"
                                        className="w-full p-2 border rounded"
                                    />
                                    <button 
                                        onClick={setUsernameFn}
                                        className="bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
                                    >
                                        Start Chatting
                                    </button>
                                </div>
                            ) : (
                                <>
                                    <div className="flex-grow overflow-y-auto p-4 space-y-2">
                                        {messages.map((msg, index) => (
                                            <div 
                                                key={index} 
                                                className={`p-2 rounded max-w-[80%] ${
                                                    msg.username === username 
                                                    ? 'bg-blue-100 self-end ml-auto' 
                                                    : 'bg-gray-100'
                                                }`}
                                            >
                                                <div className="font-semibold text-xs text-gray-600">{msg.username}</div>
                                                <div>{msg.text}</div>
                                            </div>
                                        ))}
                                        <div ref={messagesEndRef} />
                                    </div>
                                    
                                    <div className="p-4 flex space-x-2">
                                        <input 
                                            type="text"
                                            value={inputMessage}
                                            onChange={(e) => setInputMessage(e.target.value)}
                                            onKeyPress={handleKeyPress}
                                            placeholder="Type a message..."
                                            className="flex-grow p-2 border rounded"
                                        />
                                        <button 
                                            onClick={sendMessage}
                                            className="bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
                                        >
                                            <Send size={20} />
                                        </button>
                                    </div>
                                </>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // Render the React component
        ReactDOM.render(
            <ChatPlugin />,
            document.getElementById('chat-container')
        );
    </script>
</body>
</html>
